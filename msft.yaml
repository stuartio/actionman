
trigger: none

parameters:
  - name: Environment
    type: string
    default: Production
    values:
      - Production
      - Staging
      - RC
      - PPE

pool:
  vmImage: 'windows-2025'

variables:
  group: akamai-creds
  test1: 'this is my variable'

steps:
  - task: PowerShell@2
    displayName: 'Run Maintenance Script with PowerShell'
    env:
      AKAMAI_HOST: $(AkamaiHost)
      AKAMAI_CLIENT_TOKEN: $(AkamaiClientToken)
      AKAMAI_ACCESS_TOKEN: $(AkamaiAccessToken)
      AKAMAI_CLIENT_SECRET: $(AkamaiClientSecret)
    inputs:
      targetType: 'inline'
      script: |
        Write-Host "Test 1 = $Test1"
        gci env:
        Set-PSRepository PSGallery -InstallationPolicy Trusted
        Install-Module Akamai.Netstorage -Force -Scope CurrentUser
        $Creds = Get-AkamaiCredentials
        Write-Host $Creds.Host
        $UploadAccount = Get-NetstorageUploadAccount -UploadAccountID akamaipowershell -Debug
      pwsh: true
